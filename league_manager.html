<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JUWA ãƒªãƒ¼ã‚°ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
    <link rel="stylesheet" href="style.css">
    <style>
        :root { --primary: #2ecc71; --bg: #1a1a1a; --card: #2c3e50; --text: #ecf0f1; }
        body { font-family: sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        h1, h2 { color: var(--primary); text-align: center; }
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-size: 0.9rem; color: #bdc3c7; }
        input { width: 100%; padding: 12px; border: none; border-radius: 5px; background: #34495e; color: white; box-sizing: border-box; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 5px; background: var(--primary); color: white; font-weight: bold; cursor: pointer; font-size: 1rem; }
        .btn:active { transform: scale(0.98); opacity: 0.9; }
        .league-item { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 5px; margin-bottom: 10px; border-left: 4px solid var(--primary); }
        .league-item small { color: #bdc3c7; }
        .status-badge { float: right; font-size: 0.8rem; padding: 2px 8px; border-radius: 10px; background: var(--primary); color: white; }
        .nav-link { text-align: center; display: block; color: var(--primary); text-decoration: none; margin-top: 20px; }
    </style>
</head>
<body>

<div class="container">
    <div class="viewer-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <button type="button" class="btn-sm" onclick="location.href='index.html'">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>
            <button type="button" class="btn-sm" onclick="location.href='manual/manual_league'">æ“ä½œãƒãƒ‹ãƒ¥ã‚¢ãƒ«</button>
    </div>
    <h1>ğŸ† ãƒªãƒ¼ã‚°ç®¡ç†</h1>

    <section class="card">
        <h2>æ–°è¦ãƒªãƒ¼ã‚°ç™»éŒ²</h2>
        <div class="input-group">
            <label>å¤§ä¼šç•¥ç§° (IDç”¨ãƒ»åŠè§’è‹±æ•°æ¨å¥¨)</label>
            <input type="text" id="league-id" placeholder="ä¾‹: JUWA2026S">
        </div>
        <div class="input-group">
            <label>æ­£å¼åç§° (è¡¨ç¤ºç”¨)</label>
            <input type="text" id="league-name" placeholder="ä¾‹: 2026å¹´åº¦ æ˜¥å­£ãƒªãƒ¼ã‚°">
        </div>
        <div class="input-group" style="display: flex; gap: 10px;">
            <div style="flex: 1;">
                <label>é–‹å§‹æ—¥</label>
                <input type="date" id="league-start">
            </div>
            <div style="flex: 1;">
                <label>çµ‚äº†æ—¥</label>
                <input type="date" id="league-end">
            </div>
        </div>
        <button type="button" id="save-btn" class="btn">ãƒªãƒ¼ã‚°ã‚’é–‹è¨­ã™ã‚‹</button>
    </section>

    <section class="card">
        <h2>ç™»éŒ²æ¸ˆã¿ãƒªãƒ¼ã‚°ä¸€è¦§</h2>
        <div id="league-list">èª­ã¿è¾¼ã¿ä¸­...</div>
    </section>

    <a href="edit-games.html" class="nav-link">è¨˜éŒ²ç”¨ã‚¢ãƒ—ãƒªã¸ â†’</a>
</div>
<script src="js/common.js"></script>
<script>
    const GAS_URL = CONST_GAS_URL;

    /**
     * ä¿å­˜å‡¦ç†
     */
    document.getElementById('save-btn').addEventListener('click', async () => {
        const id = document.getElementById('league-id').value.trim();
        const name = document.getElementById('league-name').value.trim();
        const start = document.getElementById('league-start').value;
        const end = document.getElementById('league-end').value;

        if (!id || !name || !start || !end) {
            alert("ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
            return;
        }
        if (id.includes("-")){
            alert("ãƒªãƒ¼ã‚°IDã«ä½¿ç”¨ä¸è¨±å¯æ–‡å­—ã€Œ-ï¼ˆåŠè§’ãƒã‚¤ãƒ•ãƒ³ï¼‰ã€ãŒå«ã¾ã‚Œã¦ã„ã‚‹ãŸã‚ç™»éŒ²ã§ãã¾ã›ã‚“ã€‚");
            return;
        }
        const btn = document.getElementById('save-btn');
        btn.disabled = true;
        btn.textContent = "é€ä¿¡ä¸­...";

        const payload = {
            mode: "saveLeague",
            leagueId: id,
            leagueName: name,
            startDate: start,
            endDate: end
        };

        try {
            await postToGAS(GAS_URL, payload);
            alert("ãƒªãƒ¼ã‚°ã‚’ç™»éŒ²ã—ã¾ã—ãŸï¼");
            location.reload();
        } catch (e) {
            alert("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ");
            btn.disabled = false;
            btn.textContent = "ãƒªãƒ¼ã‚°ã‚’é–‹è¨­ã™ã‚‹";
        } 
    });

    /**
     * ä¸€è¦§å–å¾—
     */
    async function loadLeagues() {
        const listEl = document.getElementById('league-list');
        try {
            const res = await fetch(`${GAS_URL}?mode=getLeagues&_=${Date.now()}`);
            const leagues = await res.json();

            if (leagues.length === 0) {
                listEl.innerHTML = "<p>ç™»éŒ²ã•ã‚ŒãŸãƒªãƒ¼ã‚°ã¯ã‚ã‚Šã¾ã›ã‚“</p>";
                return;
            }

            // league_manager.html ã® loadLeagues é–¢æ•°å†…ã€mapå‡¦ç†ã®éƒ¨åˆ†ã‚’ä¿®æ­£
            listEl.innerHTML = leagues.reverse().map(l => `
            <div class="league-item">
                <span class="status-badge">${l.status}</span>
                <strong>${l.name}</strong><br>
            <small>ID: ${l.id} | æœŸé–“: ${l.start} ï½ ${l.end}</small>
            <div style="margin-top: 10px; text-align: right;">
            <button onclick="location.href='edit-games.html?leagueId=${l.id}'" 
                    style="background: #3498db; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; font-size: 0.8rem;">
                ã“ã®ãƒªãƒ¼ã‚°ã®è©¦åˆã‚’è¨˜éŒ²ã™ã‚‹
            </button>
            </div>
            </div>
        `).join('');
        } catch (e) {
            listEl.innerHTML = "<p>ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</p>";
        }
    }

    loadLeagues();
</script>

</body>
</html>